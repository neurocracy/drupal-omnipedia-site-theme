// -----------------------------------------------------------------------------
//   Commerce checkout layout partial
// -----------------------------------------------------------------------------

@use '../../layout/config' as layout-config; // Configure layout.
@use 'base:layout/vertical_spacing' as vertical-spacing;
@use 'base:global/content';
@use 'sass/helpers/breakpoint';
@use 'sass/helpers/layout';
@use 'sass/helpers/selector';

.layout-checkout-form {

  display: flex;
  flex-wrap: wrap;

  --region-gap: #{layout-config.$gap};
  --region-min-width: 18em;

  gap: var(--region-gap);

  .layout-region {
    flex-grow: 1;

    min-width: var(--region-min-width);

    box-sizing: border-box;

    &-checkout-main, &-checkout-secondary {
      // This lays out these sections as two columns side-by-side, if space
      // permits. The 0.1em is to account for rounding errors.
      width: calc(50% - var(--region-gap) / 2 - 0.1em);
    }

  }

  &::after {
    display: none;
  }

  .checkout-pane-review {
    // This attempts to line up the top of the first fieldset with the adjacent
    // secondary column <h3>.
    margin-top: -0.9em;
  }

  // This contains an <iframe> that's got a high z-index set inline, which ends
  // up layering this above elements such as the header and back to top widget.
  .paypal-buttons-container {
    position:   relative;
    z-index:    1;
  }

  .address-book-edit-button {
    // Reset Classy.
    margin-left:  0;
    margin-right: 0;
  }

  @include vertical-spacing.against-previous(
    '.address-book-edit-button',
    $spacing-small: content.$item-vertical-spacing-small,
    $spacing-large: content.$item-vertical-spacing-large
  );
}

.layout-region-checkout-main {
  @include vertical-spacing.against-previous(
    '.form-wrapper',
    $spacing-small: content.$item-vertical-spacing-small,
    $spacing-large: content.$item-vertical-spacing-large
  );
}

.layout-region-checkout-secondary {
  @include layout.use-grid {
    h3:first-child {
      margin-top: -0.55em;
    }
  }
}

.layout-region-checkout-footer {
  .form-actions {

    margin-top:     0;
    margin-bottom:  0;

    @include layout.use-grid {
      // @todo Make this work without causing the back link to expand and have
      //   phantom clickable space.
      //
      // grid-template-columns:  repeat(auto-fit, minmax(10em,   1fr));
      // grid-template-rows:     repeat(auto-fit, minmax(2.6em,  1fr));

      // @todo Apply this only when there are two or more items in the form
      //   actions, i.e. not a step that has just the primary button. Applying
      //   this when there's just the one button causes the button to be
      //   aligned to the left.
      // @include selector.root-conditions(('[dir=ltr]', '[dir=rtl]'), 'html') {
      //   justify-content: space-between;
      // }

      .button--primary,
      .paypal-buttons-container {
        order: 2;
      }

      .link--previous {
        order: 1;
      }

      .paypal-buttons-container {
        // This attempts to vertically centre the buttons with the adjacent
        // link.
        top: 0.25em;

        min-width: 12em;
      }
    }
  }
}

@include vertical-spacing.against-previous(
  '.checkout-pane-order-summary',
  $spacing-small: content.$item-vertical-spacing-small,
  $spacing-large: content.$item-vertical-spacing-large
);

.checkout-order-summary {
  // This table lists the products in the order.
  table {
    // Override ambientimpact_base styles.
    display: table;

    width:      100%;
    max-width:  100%;

    // This table cell contains the price for a product and so we align it with
    // the end of the block to match the .order-total-line elements below it.
    td:last-child {
      text-align: end;
    }
  }

  // This is the <div> that contains the subtotal and total for the order.
  > table ~ div {
    @include vertical-spacing.vertical-spacing(
      $spacing-small: content.$item-vertical-spacing-small,
      $spacing-large: content.$item-vertical-spacing-large
    );
  }

  // These match the horizontal padding on the base table styles.
  .order-total-line {
    padding-left:   var(--table-cell-padding-horizontal-edge);
    padding-right:  var(--table-cell-padding-horizontal-edge);
  }
}
